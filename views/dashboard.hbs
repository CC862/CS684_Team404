<!DOCTYPE html>
<style>
  /* Add a black background color to the top navigation */
  /* Style the navigation bar */
.navbar {
  overflow: hidden;
  display: flex;
  justify-content: center;
  align-items: center;
  margin-bottom: 10px;
  flex-wrap: wrap;
  height: 60px;
}

/* Style the links inside the navigation bar */
.navbar .nav-button {
  position: relative; /* change position to relative */
  float: left;
  text-align: center;
  padding: 14px 16px;
  text-decoration: none;
  font-size: 13px;
  display: inline-block;
  background-color: blue;
  color: white;
  border: none;
  border: 2px solid blue;
  border-radius: 5px;
  cursor: pointer;
  margin: 0;
  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
  transition: box-shadow 0.3s ease-in-out;
}


  .container {
    display: grid;
    grid-template-rows: auto 1fr; /* set header and main to auto and 1fr respectively */
    grid-template-columns: 1fr; /* set one column for both header and main */
    height: 100vh; /* set height to 100vh for full page height */
  }

  .header {
    padding: 20px;
    text-align: center;
    background: #023406;
    color: white;
    font-size: 30px;
  }

  .title {
    font-size: 36px;
    margin: 0;
    padding: 10px; /* add padding to title */
    border: 2px solid#023406; /* add border to title */
    background-color:#023406;
    border-bottom: none; /* remove border from bottom of title */
  }

  .main {
    padding: 20px;
  }

  .articles {
    margin-top: 35px;
  }

  .articles h2 {
    font-size: 32px;
    text-align: center;
  }

  .article {
    border: 2px solid #7e7a7a;
    padding: 20px;
    margin-bottom: 20px;
  }

  /*adjusting image display of article */
  .article img {
    max-width: 150%;
    height: 400px
  }

  .article h4 {
    margin: 0;
  }

  .article p {
    margin-top: 10px;
  }

</style>
<html>

  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../stylesheets/style.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </head>

  <body>
    <div class="container">
      <header class="header">
        <h1 class="title">Welcome to your Dashboard, {{username}}!</h1>
        <p>Today is: <span id="datetime"></span></p>
      </header>

      <nav class="navbar">
        <a href="/" class="nav-button" id="logout-btn">Log Out</a>
        <a href="#" class="nav-button">Adjust your Settings</a>
      </nav>

      <main class="main">
        <section class="articles">
          <h2>Displaying: "{{category}}" news</h2>
          <div id="news"></div>
        </section>
      </main>
    </div>
      
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script>

      $(document).ready(function() {
         fetch(`https://newsapi.org/v2/top-headlines?country=us&category={{category}}&apiKey={{API_KEY}}`)
          .then(response => response.json())
          .then(data => {
            var newsData = data;
            var newsHtml = '';
            $.each(newsData.articles, function(i, item) {
              newsHtml += '<div class="article">';
                // add image tag here
              newsHtml += '<img src="' + item.urlToImage + '"/>'; 
              //tile of article
              newsHtml += '<h4>' + item.title + '</h4>';
              //article description
              newsHtml += '<p>' + item.description + '</p>';
              //read more link
              newsHtml += '<a href="' + item.url + '">Read more</a>';
              newsHtml += '</div>';
            });
            $('#news').html(newsHtml);
          })
          .catch(error => {
            console.error('Error:', error);
          });
      });
    </script>
    <script>

      const username = "{{username}}";
      const usernameElement = document.getElementById('username');
      usernameElement.textContent = username;


    </script>
    <script>
        const datetimeElement = document.getElementById('datetime');
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        const datetime = new Date().toLocaleDateString('en-US', options);
        datetimeElement.textContent = datetime;
    </script>
    <script>
      // Check if registrationSuccess query parameter exists
      const urlParams = new URLSearchParams(window.location.search);
      const logout = urlParams.get('logout');
      
      // If registrationSuccess is true, show the message
      if (logout === 'true') {
        const messageDiv = document.getElementById('logout-success-message');
        messageDiv.innerHTML = '<p class="text-success">logged out.</p>';
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        var logoutButton = document.getElementById("logout-btn");
        var loggedIn = sessionStorage.getItem("loggedIn");

        if (!loggedIn) {
          window.location.href = "/signin";
        }

        logoutButton.addEventListener("click", function() {
          // Your logout code goes here
          console.log("User has been logged out");
          sessionStorage.removeItem("loggedIn");
          window.location.href = "/signin";
        });

        sessionStorage.setItem("loggedIn", true);
      </script>

  </body>
</html>
